schemaVersion: 2.2.2
metadata:
  name: intellij-official
  displayName: IntelliJ (Official Image)
  attributes:
    controller.devfile.io/devworkspace-config:
      workspace:
        progressTimeout: "15m"
components:
  - name: tools
    container:
      # The official image with everything pre-installed
      image: jetbrains/projector-idea-c:latest
      memoryLimit: 4Gi
      mountSources: true
      
      # --- THE ONLY CONFIGURATION NEEDED ---
      env:
        # 1. Force the container to treat your persistent volume as Home.
        # This solves 100% of the permission/crash issues.
        - name: HOME
          value: /projects
          
        # 2. Force the server to listen on all interfaces so Ingress works.
        - name: ORG_JETBRAINS_PROJECTOR_SERVER_HOST
          value: "0.0.0.0"
          
        # 3. Force the specific port we exposed.
        - name: ORG_JETBRAINS_PROJECTOR_SERVER_PORT
          value: "8887"

      endpoints:
        - name: intellij-direct
          targetPort: 8887
          attributes:
            public: "true"
            protocol: http
            secure: "false"
            discoverable: "true"
            
      # Override the entrypoint to ensure it picks up our Env Vars
      # and doesn't try to run its own internal setup scripts that might fail.
      command: ["/bin/sh", "-c"]
      args:
        - |
          echo "Starting Official JetBrains Projector..."
          # We just run the server. No installation, no patching.
          projector run
